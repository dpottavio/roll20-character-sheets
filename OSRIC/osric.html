<input type="hidden" class="sheet-sheet_toggle" name="attr_sheet_tab"  value="pc_tab"/>
<div class="sheet-two_col">
  <div class="sheet-two_col">
    <input type="radio" id="pc_tab_button" name="attr_sheet_toggle" value="pc_tab" checked/>
    <label class="sheet-radio_label" for="attr_sheet_toggle">PC Sheet</label>
  </div>
  <div class="sheet-two_col">
    <input type="radio" id="monster_tab_button" name="attr_sheet_toggle" value="monster_tab" />
    <label class="sheet-radio_label" for="attr_sheet_toggle">Monster Sheet</label>
  </div>
</div>
<h1>OSRIC</h1>
<br/>
<!--
PC Sheet
-->
<div class="sheet-pc_tab">
  <div class="sheet-one_col">
    <div class="sheet-two_col">
      <div class="sheet-two_col_box">
        <label class="sheet-txt_label">Name</label>
        <input class="sheet-txt_input" type="text" name="attr_character_name"/>
        <label class="sheet-txt_label">Class</label>
        <input class="sheet-txt_input" type="text" name="attr_class"/>
        <label class="sheet-txt_label">Race</label>
        <input class="sheet-txt_input" type="text" name="attr_race"/>
        <label class="sheet-txt_label">Alignment</label>
        <input class="sheet-txt_input" type="text" name="attr_alignment"/>
        <label class="sheet-txt_label">Languages</label>
        <input class="sheet-txt_input" type="text" name="attr_languages"/>
        <label class="sheet-txt_label">Religion</label>
        <input class="sheet-txt_input" type="text" name="attr_religion"/>
        <label class="sheet-txt_label">Secondary Skills</label>
        <input class="sheet-txt_input" type="text" name="attr_skills"/>
        <label class="sheet-txt_label">Experience Points</label>
        <input class="sheet-txt_input" type="text" name="attr_xp"/>
      </div>
      <div class="sheet-two_col_box">
        <label class="sheet-txt_label">HP</label>
        <input class="sheet-digit_input_left" type="number" name="attr_hp"/>
        <label class="sheet-txt_label">Max HP</label>
        <input class="sheet-digit_input_left" type="number" name="attr_hp_max"/>
        <label class="sheet-txt_label">HD</label>
        <select class="sheet-digit_input_left" name="attr_hd">
          <option value="d4">d4</option>
          <option value="d6">d6</option>
          <option value="d8">d8</option>
          <option value="d10">d10</option>
          <option value="d12">d12</option>
        </select>
        <label class="sheet-txt_label">Base MV</label>
        <select class="sheet-digit_input_left" name="attr_base_mv">
          <option value="120">120</option>
          <option value="90">90</option>
          <option value="60">60</option>
          <option value="30">30</option>
        </select>
        <label class="sheet-txt_label">Level</label>
        <input class="sheet-digit_input_left" type="number" name="attr_level"/>
        <label class="sheet-txt_label">Age</label>
        <input class="sheet-digit_input_left" type="text" name="attr_age"/>
        <label class="sheet-txt_label">Height</label>
        <input class="sheet-digit_input_left" type="text" name="attr_height"/>
        <label class="sheet-txt_label">Weight</label>
        <input class="sheet-digit_input_left" type="text" name="attr_weight"/>
        <label class="sheet-txt_label">Gender</label>
        <input class="sheet-digit_input_left" type="text" name="attr_gender"/>
      </div>
    </div>
    <div class="sheet-three_col">
      <div class="sheet-one_col_box">
        <div class="sheet-stat_block_wide">
          <label class="sheet-txt_title">STR</label>
          <input class="sheet-digit_input_small_bold" type="text" name="attr_str"/>
          <label class="sheet-txt_title_plain">&#47;</label>
          <input class="sheet-digit_input_small_bold" type="text" name="attr_str_p"/>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">STR Mod:</label>
          <input class="sheet-digit_input_stat" type="number" name="attr_str_mod" value="0"/>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">To-Hit Mod:</label>
          <span class="sheet-txt_label" name="attr_hit_mod" value="0"></span>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">Damage Mod:</label>
          <span class="sheet-txt_label_small" name="attr_dmg_mod" value="0"></span>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">Encumbrance Mod:</label>
          <span class="sheet-txt_label_small" name="attr_encum_mod" value="0"></span>
        </div>
        <div class="sheet-stat_block_small">
          <button class="sheet-stat_button" type="roll" name="minor_test_of_st" value="&{template:default} {{name=Minor STR Test (@{character_name})}} {{Roll (d6) = [[d6]]}} {{Success on = @{str_minor_test}:6}}">Minor Test</button>
          <button class="sheet-stat_button" type="roll" name="major_test_of_st" value="&{template:default} {{name=Major STR Test (@{character_name})}} {{Roll (%) = [[d100]]}} {{Success on = @{str_major_test}%}}">Major Test</button>
        </div>
      </div>
      <div class="sheet-one_col_box">
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_title">DEX</label>
          <input class="sheet-digit_input_small_bold" type="text" name="attr_dex"/>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">DEX Mod:</label>
          <input class="sheet-digit_input_stat" type="number" name="attr_dex_mod" value="0"/>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">Surprise Mod:</label>
          <span class="sheet-txt_label_small" name="attr_surprise_mod" value="0"></span>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">Missile Mod:</label>
          <span class="sheet-txt_label_small" name="attr_missile_mod" value="0"></span>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">AC Mod:</label>
          <span class="sheet-txt_label_small" name="attr_ac_mod" value="0"></span>
        </div>
        <div class="sheet-stat_block_small">
          <button class="sheet-stat_button" type="roll" name="test_of_dex" value="&{template:default} {{name=Test of DEX (@{character_name})}} {{Roll (d20) = [[d20]]}} {{Success on = @{dex}:20}}">DEX Test</button>
        </div>
      </div>
      <div class="sheet-one_col_box">
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_title">CON</label>
          <input class="sheet-digit_input_small_bold" type="text" name="attr_con"/>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">CON Mod:</label>
          <input class="sheet-digit_input_stat" type="number" name="attr_con_mod" value="0"/>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">Fighter&#47;Paladin&#47;Ranger:</label>
          <input class="sheet-stat_checkbox" type="checkbox" name="attr_has_con_fighter_toggle"/>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">HP Mod:</label>
          <span class="sheet-txt_label_small" name="attr_hp_mod" value="0"></span>
        </div>
        <div class="sheet-stat_block_small">
          <input type="hidden" name="attr_resurrect" value="0"/>
          <button class="sheet-stat_button" type="roll" name="resurrect_test" value="&{template:default} {{name=Resurrection Test (@{character_name})}} {{Roll (%) = [[d100]]}} {{Success on = @{resurrect}%}}">Resurrect Test</button>
          <button class="sheet-stat_button" type="roll" name="new_hp" value="&{template:default} {{name=New HP (@{character_name})}} {{Roll (@{hd}) = [[@{hd}+(@{hp_mod})]]}}">New HP</button>
        </div>
        <div class="sheet-stat_block_small">
          <input type="hidden" name="attr_sys_shock" value="0"/>
          <button class="sheet-stat_button" type="roll" name="sys_shock_test" value="&{template:default} {{name=System Shock Test (@{character_name})}} {{Roll (d100) = [[d100]]}} {{Success on = @{sys_shock}%}}">Sys Shock Test</button>
        </div>
      </div>
      <div class="sheet-one_col_box">
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_title">INT</label>
          <input class="sheet-digit_input_small_bold" type="text" name="attr_int"/>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">INT Mod:</label>
          <input class="sheet-digit_input_stat" type="number" name="attr_int_mod" value="0"/>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">Max Extra Languages:</label>
          <span class="sheet-txt_label_small" name="attr_max_lang"></span>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">Min Spells:</label>
          <span class="sheet-txt_label_small" name="attr_min_spell"></span>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">Max Spells:</label>
          <span class="sheet-txt_label_small" name="attr_max_spell"></span>
        </div>
        <div class="sheet-stat_block_small">
          <button class="sheet-stat_button" type="roll" name="learn_spell" value="&{template:default} {{name=Learn Magician Spell (@{character_name})}} {{Roll (%) = [[d100]]}} {{Success on = @{learn_spell}%}}">Learn Spell</button>
        </div>
      </div>
      <div class="sheet-one_col_box">
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_title">WIS</label>
          <input class="sheet-digit_input_small_bold" type="text" name="attr_wis"/>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">WIS Mod:</label>
          <input class="sheet-digit_input_stat" type="number" name="attr_wis_mod" value="0"/>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">Mental Mod:</label>
          <span class="sheet-txt_label_small" name="attr_mental_mod" value="0"></span>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">Bounus Spell:</label>
          <span class="sheet-txt_label_small" name="attr_bonus_spell" value="0"></span>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">Spell Failure (%):</label>
          <span class="sheet-txt_label_small" name="attr_spell_failure" value="0"></span>
        </div>
      </div>
      <div class="sheet-one_col_box">
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_title">CHA</label>
          <input class="sheet-digit_input_small_bold" type="text" name="attr_cha"/>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">CHA Mod:</label>
          <input class="sheet-digit_input_stat" type="number" name="attr_cha_mod" value="0"/>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">Max. Henchmen:</label>
          <span class="sheet-txt_label_small" name="attr_max_hench" value="0"></span>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">Loyalty Mod:</label>
          <span class="sheet-txt_label_small" name="attr_loyalty_mod" value="0"></span>
        </div>
        <div class="sheet-stat_block_small">
          <label class="sheet-txt_label_small">Reaction Mod:</label>
          <span class="sheet-txt_label_small" name="attr_react_mod" value="0"></span>
        </div>
      </div>
    </div>
    <div class="sheet-two_col">
      <div class="sheet-one_col_box">
        <h2>Saving Throw</h2>
        <div class="sheet-one_col">
          <div class="sheet-two_col">
            <label class="sheet-txt_label">Rod,Staff,Wand</label>
            <input class="sheet-digit_input" type="number" name="attr_rod_sv"/>
            <label class="sheet-txt_label">Breath Weapon</label>
            <input class="sheet-digit_input" type="number" name="attr_breath_sv"/>
            <label class="sheet-txt_label">Death,Paralysis,Poison</label>
            <input class="sheet-digit_input" type="number" name="attr_death_sv"/>
            <label class="sheet-txt_label">Petrifaction,Polymorph</label>
            <input class="sheet-digit_input" type="number" name="attr_petrif_sv"/>
            <label class="sheet-txt_label">Spell</label>
            <input class="sheet-digit_input" type="number" name="attr_spell_sv"/>
            <button class="sheet-stat_button" type="roll" name="sv_roll" value="&{template:default} {{name=Saving Throw (@{character_name})}} {{Roll (d20) = [[d20]]}} {{Rod,Staff,Wand = @{rod_sv}}} {{Breath = @{breath_sv}}} {{Death,Paralysis,Poison = @{death_sv}}} {{Petrifaction,Polymorph = @{petrif_sv}}} {{Spell = @{spell_sv}}}">Saving Throw</button>
          </div>
        </div>
      </div>
      <div class="sheet-one_col_box">
        <h2>Armour</h2>
        <div class="sheet-one_col">
          <div class="sheet-one_col">
            <div class="sheet-two_col">
              <label class="sheet-txt_title">AC</label>
              <input class="sheet-digit_input" type="number" name="attr_ac" value="10"/>
              <label class="sheet-txt_label">MV Limit</label>
              <select class="sheet-digit_input_left" name="attr_mv_limit">
                <option value="120">120</option>
                <option value="90">90</option>
                <option value="60">60</option>
                <option value="30">30</option>
              </select>
              <label class="sheet-txt_label">Type</label>
              <input class="sheet-txt_input" type="text" name="attr_armour" placeholder="none"/>
              <label class="sheet-txt_label">Shield</label>
              <input class="sheet-txt_input" type="text" name="attr_shield" placeholder="none"/>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="sheet-one_col_box">
      <h2>To-Hit Matrix</h2>
      <div class="sheet-matrix">
        <label class="sheet-table_header_small">-10</label>
        <label class="sheet-table_header_small">-9</label>
        <label class="sheet-table_header_small">-8</label>
        <label class="sheet-table_header_small">-7</label>
        <label class="sheet-table_header_small">-6</label>
        <label class="sheet-table_header_small">-5</label>
        <label class="sheet-table_header_small">-4</label>
        <label class="sheet-table_header_small">-3</label>
        <label class="sheet-table_header_small">-2</label>
        <label class="sheet-table_header_small">-1</label>
        <label class="sheet-table_header_small">0</label>
        <label class="sheet-table_header_small">1</label>
        <label class="sheet-table_header_small">2</label>
        <label class="sheet-table_header_small">3</label>
        <label class="sheet-table_header_small">4</label>
        <label class="sheet-table_header_small">5</label>
        <label class="sheet-table_header_small">6</label>
        <label class="sheet-table_header_small">7</label>
        <label class="sheet-table_header_small">8</label>
        <label class="sheet-table_header_small">9</label>
        <label class="sheet-table_header_small">10</label>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_n10" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_n9" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_n8" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_n7" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_n6" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_n5" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_n4" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_n3" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_n2" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_n1" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_0" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_1" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_2" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_3" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_4" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_5" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_6" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_7" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_8" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_9" value="0"/>
        <input class="sheet-digit_input_center" type="text" name="attr_to_hit_10" value="0"/>
      </div>
    </div>
    <input type="hidden" class="sheet-weapon_toggle" name="attr_weapon_tab"  value="melee_tab"/>
    <div class="sheet-two_col">
      <div class="sheet-two_col">
        <input type="radio" id="melee_tab_button" name="attr_weapon_toggle" value="melee_tab" checked/>
        <label class="sheet-radio_label" for="attr_weapon_toggle">Melee Weapons</label>
      </div>
      <div class="sheet-two_col">
        <input type="radio" id="missile_tab_button" name="attr_weapon_toggle" value="missile_tab" />
        <label class="sheet-radio_label" for="attr_weapon_toggle">Missile Weapons</label>
      </div>
    </div>
    <div class="sheet-melee_tab">
      <div class="sheet-one_col_box">
        <div>
          <h2>Melee Weapons</h2>
          <div class="sheet-weapon_table">
            <label class="sheet-table_header_small">Attack Roll</label>
            <label class="sheet-table_header_large2">Type</label>
            <label class="sheet-table_header_small">Atk. Rate</label>
            <label class="sheet-table_header_small">Dmg. S/M</label>
            <label class="sheet-table_header_small">Dmg. L</label>
            <label class="sheet-table_header_small">Dmg. Mod</label>
            <label class="sheet-table_header_small">Atk. Mod</label>
          </div>
          <fieldset class="repeating_melee">
            <div class="sheet-weapon_table">
              <button class="sheet-stat_button" type="roll" name="melee" value="&{template:default} {{name=Melee Attack (@{character_name})}} {{Roll to Hit = [[d20+@{hit_mod}+@{weapon_hit_mod}]]}} {{Damage S/M = [[@{weapon_dmg_m}+@{dmg_mod}+@{weapon_dmg_mod}]]}} {{Damage L = [[@{weapon_dmg_l}+@{dmg_mod}+@{weapon_dmg_mod}]]}}"></button>
              <input class="sheet-table_entry_large2_left" type="text" name="attr_weapon_type" placeholder="type"/>
              <input class="sheet-table_entry_small" type="text" name="attr_weapon_rate" placeholder="RoF"/>
              <input class="sheet-table_entry_small" type="text" name="attr_weapon_dmg_m" value="0"/>
              <input class="sheet-table_entry_small" type="text" name="attr_weapon_dmg_l" value="0"/>
              <input class="sheet-table_entry_small" type="text" name="attr_weapon_dmg_mod" value="0"/>
              <input class="sheet-table_entry_small" type="text" name="attr_weapon_hit_mod" value="0"/>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
    <div class="sheet-missile_tab">
      <div class="sheet-one_col_box">
        <div>
          <h2>Missile Weapons</h2>
          <div class="sheet-weapon_table">
            <label class="sheet-table_header_small">Attack Roll</label>
            <label class="sheet-table_header_large2">Type</label>
            <label class="sheet-table_header_small">Range</label>
            <label class="sheet-table_header_small">Atk. Rate</label>
            <label class="sheet-table_header_small">Dmg. S/M</label>
            <label class="sheet-table_header_small">Dmg. L</label>
            <label class="sheet-table_header_small">Dmg. Mod</label>
            <label class="sheet-table_header_small">Atk. Mod</label>
          </div>
          <fieldset class="repeating_missile">
            <div class="sheet-weapon_table">
              <button class="sheet-stat_button" type="roll" name="melee" value="&{template:default} {{name=Missile Attack (@{character_name})}} {{Roll to Hit = [[d20+@{hit_mod}+@{weapon_hit_mod}]]}} {{Range = @{weapon_range}}} {{Damage S/M = [[@{weapon_dmg_m}+@{dmg_mod}+@{weapon_dmg_mod}]]}} {{Damage L = [[@{weapon_dmg_l}+@{dmg_mod}+@{weapon_dmg_mod}]]}}"></button>
              <input class="sheet-table_entry_large2_left" type="text" name="attr_weapon_type" placeholder="type"/>
              <input class="sheet-table_entry_small" type="text" name="attr_weapon_range" placeholder="range"/>
              <input class="sheet-table_entry_small" type="text" name="attr_weapon_rate" placeholder="rate"/>
              <input class="sheet-table_entry_small" type="text" name="attr_weapon_dmg_m" value="0"/>
              <input class="sheet-table_entry_small" type="text" name="attr_weapon_dmg_l" value="0"/>
              <input class="sheet-table_entry_small" type="text" name="attr_weapon_dmg_mod" value="0"/>
              <input class="sheet-table_entry_small" type="text" name="attr_weapon_hit_mod" value="0"/>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
    <input type="hidden" class="sheet-ability_toggle" name="attr_ability_tab"  value="class_tab"/>
    <div class="sheet-two_col">
      <div class="sheet-two_col">
        <input type="radio" id="class_tab_button" name="attr_ability_toggle" value="class_tab" checked/>
        <label class="sheet-radio_label" for="attr_ability_toggle">Abilities</label>
      </div>
      <div class="sheet-two_col">
        <input type="radio" id="spell_tab_button" name="attr_ability_toggle" value="spell_tab" />
        <label class="sheet-radio_label" for="attr_ability_toggle">Spells</label>
      </div>
    </div>
    <div class="sheet-class_tab">
      <div class="sheet-one_col_box">
        <h2>Class Abilities</h2>
        <div class="sheet-ability_table">
          <label class="sheet-table_header_small">Roll</label>
          <label class="sheet-table_header">Name</label>
          <label class="sheet-table_header_small">Die</label>
          <label class="sheet-table_header_small">Threshold</label>
          <label class="sheet-table_header_xlarge">Description</label>
        </div>
        <fieldset class="repeating_abilities">
          <div class="sheet-ability_table">
            <button class="sheet-stat_button" type="roll" name="ability" value="&{template:default} {{name=@{ability_name} (@{character_name})}} {{Roll (@{ability_die})= [[@{ability_die}]]}} {{Success on = @{ability_threshold}}}"></button>
            <input class="sheet-table_entry_large" type="text" name="attr_ability_name" placeholder="ability name"/>
            <input class="sheet-table_entry_small" type="text" name="attr_ability_die" placeholder="die"/>
            <input class="sheet-table_entry_small" type="text" name="attr_ability_threshold" placeholder="threshold"/>
            <input class="sheet-table_entry_xlarge" type="text" name="attr_ability_desc" placeholder="description"/>
          </div>
        </fieldset>
      </div>
    </div>
    <div class="sheet-spell_tab">
      <div class="sheet-one_col_box">
        <h3>Magician Spell Slots</h3>
        <div class="sheet-spell_slot_table">
          <label class="sheet-table_header_small">Level 1</label>
          <label class="sheet-table_header_small">Level 2</label>
          <label class="sheet-table_header_small">Level 3</label>
          <label class="sheet-table_header_small">Level 4</label>
          <label class="sheet-table_header_small">Level 5</label>
          <label class="sheet-table_header_small">Level 6</label>
          <input class="sheet-table_entry_small" type="number" name="attr_mag_spell_slot_1" value="0"/>
          <input class="sheet-table_entry_small" type="number" name="attr_mag_spell_slot_2" value="0"/>
          <input class="sheet-table_entry_small" type="number" name="attr_mag_spell_slot_3" value="0"/>
          <input class="sheet-table_entry_small" type="number" name="attr_mag_spell_slot_4" value="0"/>
          <input class="sheet-table_entry_small" type="number" name="attr_mag_spell_slot_5" value="0"/>
          <input class="sheet-table_entry_small" type="number" name="attr_mag_spell_slot_6" value="0"/>
        </div>
        <h3>Cleric Spell Slots</h3>
        <div class="sheet-spell_slot_table">
          <label class="sheet-table_header_small">Level 1</label>
          <label class="sheet-table_header_small">Level 2</label>
          <label class="sheet-table_header_small">Level 3</label>
          <label class="sheet-table_header_small">Level 4</label>
          <label class="sheet-table_header_small">Level 5</label>
          <label class="sheet-table_header_small">Level 6</label>
          <input class="sheet-table_entry_small" type="number" name="attr_clr_spell_slot_1" value="0"/>
          <input class="sheet-table_entry_small" type="number" name="attr_clr_spell_slot_2" value="0"/>
          <input class="sheet-table_entry_small" type="number" name="attr_clr_spell_slot_3" value="0"/>
          <input class="sheet-table_entry_small" type="number" name="attr_clr_spell_slot_4" value="0"/>
          <input class="sheet-table_entry_small" type="number" name="attr_clr_spell_slot_5" value="0"/>
          <input class="sheet-table_entry_small" type="number" name="attr_clr_spell_slot_6" value="0"/>
        </div>
        <h2>Spells</h2>
        <div class="sheet-one_col">
          <div class="sheet-spell_table">
            <label class="sheet-table_header_large">Name</label>
            <label class="sheet-table_header_small">Level</label>
            <label class="sheet-table_header_small">Range</label>
            <label class="sheet-table_header_small">Duration</label>
            <label class="sheet-table_header_small">Cast Time</label>
            <label class="sheet-table_header_small">Num. Mem.</label>
            <label class="sheet-table_header_large2">Notes</label>
          </div>
          <fieldset class="repeating_spell">
            <div class="sheet-spell_table">
              <input class="sheet-table_entry_large" type="text" name="attr_spell_name" placeholder="name"/>
              <input class="sheet-table_entry_small" type="text" name="attr_spell_level" placeholder="level"/>
              <input class="sheet-table_entry_small" type="text" name="attr_spell_range" placeholder="range"/>
              <input class="sheet-table_entry_small" type="text" name="attr_spell_duration" placeholder="duration"/>
              <input class="sheet-table_entry_small" type="text" name="attr_spell_cast_time" placeholder="segments"/>
              <input class="sheet-table_entry_small" type="number" name="attr_spell_num_mem" value="0"/>
              <input class="sheet-table_entry_large2_left" type="text" name="attr_spell_notes"/>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
    <input type="hidden" class="sheet-items_toggle" name="attr_items_tab"  value="equipment_tab"/>
    <div class="sheet-two_col">
      <div class="sheet-two_col">
        <input type="radio" id="equipment_tab_button" name="attr_items_toggle" value="equipment_tab" checked/>
        <label class="sheet-radio_label" for="attr_items_toggle">Goods</label>
      </div>
      <div class="sheet-two_col">
        <input type="radio" id="hireling_tab_button" name="attr_items_toggle" value="hireling_tab" />
        <label class="sheet-radio_label" for="attr_items_toggle">Hirelings</label>
      </div>
    </div>
    <div class="sheet-equipment_tab">
      <div class="sheet-two_col_box">
        <div class="sheet-one_col">
          <div class="sheet-one_col">
            <h2>Coins</h2>
            <div class="sheet-coin_table">
              <label></label>
              <label class="sheet-table_header_small">PP</label>
              <label class="sheet-table_header_small">GP</label>
              <label class="sheet-table_header_small">EP</label>
              <label class="sheet-table_header_small">SP</label>
              <label class="sheet-table_header_small">CP</label>
              <label class="sheet-txt_label">Equipped</label>
              <input class="sheet-table_entry_small" type="number" name="attr_pp_equip" value="0"/>
              <input class="sheet-table_entry_small" type="number" name="attr_gp_equip" value="0"/>
              <input class="sheet-table_entry_small" type="number" name="attr_ep_equip" value="0"/>
              <input class="sheet-table_entry_small" type="number" name="attr_sp_equip" value="0"/>
              <input class="sheet-table_entry_small" type="number" name="attr_cp_equip" value="0"/>
              <label class="sheet-txt_label">Stashed</label>
              <input class="sheet-table_entry_small" type="number" name="attr_pp" value="0"/>
              <input class="sheet-table_entry_small" type="number" name="attr_gp" value="0"/>
              <input class="sheet-table_entry_small" type="number" name="attr_ep" value="0"/>
              <input class="sheet-table_entry_small" type="number" name="attr_sp" value="0"/>
              <input class="sheet-table_entry_small" type="number" name="attr_cp" value="0"/>
            </div>
          </div>
          <div class="sheet-one_col">
            <h2>Equipment</h2>
            <div class="sheet-equipment_table">
              <label class="sheet-table_header_large2">Item</label>
              <label class="sheet-table_header_small">Count</label>
              <label class="sheet-table_header_small">Weight</label>
              <label class="sheet-table_header_small">Equipped</label>
            </div>
            <fieldset class="repeating_equipment">
              <div class="sheet-equipment_table">
                <input class="sheet-table_entry_large2_left" type="text" name="attr_equip_name" placeholder="name"/>
                <input class="sheet-table_entry_small" type="number" name="attr_equip_count" value="1"/>
                <input class="sheet-table_entry_small" type="text" name="attr_equip_weight" placeholder="weight"/>
                <input class="sheet-table_entry_small" type="checkbox" name="attr_equip_is" value="1" checked/>
              </div>
            </fieldset>
          </div>
        </div>
        <div class="sheet-fixed">
          <div class="sheet-one_col">
            <h2>Encumbrance</h2>
            <div class="sheet-two_col">
              <label class="sheet-txt_label">Coin Weight:</label>
              <span class="sheet-digit_input_right" type="text" name="attr_coin_encumbrance" value="0"></span>
              <label class="sheet-txt_label">Equipment Weight:</label>
              <span class="sheet-digit_input_right" type="text" name="attr_equip_encumbrance" value="0"></span>
              <label class="sheet-txt_label_bold">Total Weight:</label>
              <span class="sheet-digit_input_right_bold" type="text" name="attr_encumbrance" value="0"></span>
              <label class="sheet-txt_label">Max MV:</label>
              <span class="sheet-digit_input_right" type="text" name="attr_max_mv" value="120"></span>
              <label class="sheet-txt_label">Surprise:</label>
              <span class="sheet-digit_input_right" type="text" name="attr_encum_surprise" value=""></span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="sheet-hireling_tab">
      <div class="sheet-one_col_box">
        <h2>Hirelings/Henchmen</h2>
        <div class="sheet-hireling_table">
          <label class="sheet-table_header">Name</label>
          <label class="sheet-table_header_xlarge">Notes</label>
        </div>
        <fieldset class="repeating_hirelings">
          <div class="sheet-hireling_table">
            <input class="sheet-table_entry_large" type="text" name="attr_hireling_name" placeholder="name"/>
            <input class="sheet-table_entry_xlarge" type="text" name="attr_hireling_notes" placeholder="Notes"/>
          </div>
        </fieldset>
      </div>
    </div>
    <div class="sheet-one_col_box">
      <h2>Notes</h2>
      <div class="sheet-one_col">
        <textarea class="sheet-textarea" name="attr_notes"></textarea>
      </div>
    </div>
  </div>
</div>
<!--
Monster Sheet
-->
<div class="sheet-monster_tab">
  <div class="sheet-one_col">
    <div class="sheet-two_col">
      <div class="sheet-one_col_box">
        <h2>Stat Block</h2>
        <div class="sheet-two_col">
          <label class="sheet-txt_label">Name</label>
          <input class="sheet-txt_input" type="text" name="attr_character_name" placeholder="name"/>
          <label class="sheet-txt_label">Alias</label>
          <input class="sheet-txt_input" type="text" name="attr_monster_alias"/>
          <label class="sheet-txt_label">Size</label>
          <input class="sheet-txt_input" type="text" name="attr_monster_size"/>
          <label class="sheet-txt_label">MV</label>
          <input class="sheet-txt_input" type="text" name="attr_mv"/>
          <label class="sheet-txt_label">AC</label>
          <input class="sheet-txt_input" type="text" name="attr_ac"/>
          <label class="sheet-txt_label">HD</label>
          <input class="sheet-txt_input" type="text" name="attr_monster_hd"/>
          <label class="sheet-txt_label">Attacks</label>
          <input class="sheet-txt_input" type="text" name="attr_monster_num_attack"/>
          <label class="sheet-txt_label">Magic Resistance</label>
          <input class="sheet-txt_input" type="text" name="attr_monster_monster_mag_res"/>
          <label class="sheet-txt_label">Alignment</label>
          <input class="sheet-txt_input" type="text" name="attr_alignment"/>
          <label class="sheet-txt_label">XP</label>
          <input class="sheet-txt_input" type="text" name="attr_monster_xp"/>
        </div>
      </div>
      <div class="sheet-one_col_box">
        <h2>Notes</h2>
        <textarea class="sheet-monster_sa_area" name="attr_notes"></textarea>
      </div>
    </div>
    <div class="sheet-one_col_box">
      <h2>Attack</h2>
      <div class="sheet-monster_attack_table">
        <label class="sheet-table_header_small">Attack Roll</label>
        <label class="sheet-table_header_large2">Type</label>
        <label class="sheet-table_header_small">Atk. Mod.</label>
        <label class="sheet-table_header_small">Damage</label>
      </div>
      <fieldset class="repeating_monsterAttack">
        <div class="sheet-monster_attack_table">
          <button class="sheet-stat_button" type="roll" name="melee" value="&{template:default} {{name=Monster Attack (@{monster_alias})}} {{Roll to Hit = [[d20+@{weapon_hit_mod}]]}} {{Damage = [[@{weapon_dmg}]]}} {{Weapon=@{weapon_type}}}"></button>
          <input class="sheet-table_entry_large2_left" type="text" name="attr_weapon_type" placeholder="type"/>
          <input class="sheet-table_entry_small" type="text" name="attr_weapon_hit_mod" value="0"/>
          <input class="sheet-table_entry_small" type="text" name="attr_weapon_dmg" placeholder="damage"/>
        </div>
      </fieldset>
    </div>
  </div>
</div>

<script type="text/worker">
  const xparseInt = (val) => parseInt(val) || 0;
  const xparseFloat = (val) => parseFloat(val) || 0.0;
  const inRange = (val, min, max) => val >= min && val <= max;

  /*
   * The following function is taken from:
   *  https://wiki.roll20.net/RepeatingSum
   *
   * ===== PARAMETERS ==========
   *  destinations = the name of the attribute that stores the total quantity
   *  can be a single attribute, or an array: ['total_cost', 'total_weight']
   *  If more than one, the matching fields must be in the same order.
   *  section = name of repeating fieldset, without the repeating_
   *  fields = the name of the attribute field to be summed
   *  destination and fields both can be a single attribute: 'weight'
   *  or an array of attributes: ['weight','number','equipped']
   */
  const repeatingSum = (destinations, section, fields) => {
      if (!Array.isArray(destinations)) destinations = [destinations.replace(/\s/g, '').split(',')];
      if (!Array.isArray(fields)) fields = [fields.replace(/\s/g, '').split(',')];
      getSectionIDs(`repeating_${section}`, idArray => {
          const attrArray = idArray.reduce((m, id) => [...m, ...(fields.map(field => `repeating_${section}_${id}_${field}`))], []);
          getAttrs([...attrArray], v => {
              const getValue = (section, id, field) => v[`repeating_${section}_${id}_${field}`] === 'on' ? 1 : parseFloat(v[`repeating_${section}_${id}_${field}`]) || 0;
              const commonMultipliers = (fields.length <= destinations.length) ? [] : fields.splice(destinations.length, fields.length - destinations.length);
              const output = {};
              destinations.forEach((destination, index) => {
                  output[destination] = idArray.reduce((total, id) => total + getValue(section, id, fields[index]) * commonMultipliers.reduce((subtotal, mult) => subtotal * getValue(section, id, mult), 1), 0);
              });
              setAttrs(output);
          });
      });
  };

  on(`change:str  change:str_p change:str_mod`, () => {
      getAttrs(["str", "str_p", "str_mod"], values => {
          const str_base = xparseInt(values["str"]);
          const percent = values["str_p"];
          const str_percent = (percent == '' ? null : xparseInt(percent));
          const str_mod = xparseInt(values["str_mod"]);
          const str_val = str_base + str_mod;

          hit_mod = 0;
          encum_mod = 0;
          dmg_mod = 0;
          str_minor_test = 1;
          str_major_test = 0;
          if (str_val <= 3) {
              hit_mod = -3;
              dmg_mod = -1;
              encum_mod = -35;
              str_minor_test = 1;
              str_major_test = 0;
          } else if (inRange(str_val, 4, 5)) {
              hit_mod = -2;
              dmg_mod = -1;
              encum_mod = -25;
              str_minor_test = 1;
              str_major_test = 0;
          } else if (inRange(str_val, 6, 7)) {
              hit_mod = -1;
              dmg_mod = 0;
              encum_mod = -15;
              str_minor_test = 1;
              str_major_test = 0;
          } else if (inRange(str_val, 8, 9)) {
              hit_mod = 0;
              dmg_mod = 0;
              encum_mod = 0;
              str_minor_test = 2;
              str_major_test = 1;
          } else if (inRange(str_val, 10,11)) {
              hit_mod = 0;
              dmg_mod = 0;
              encum_mod = 0;
              str_minor_test = 2;
              str_major_test = 2;
          } else if (inRange(str_val, 12, 13)) {
              hit_mod = 0;
              dmg_mod = 0;
              encum_mod = 10;
              str_minor_test = 2;
              str_major_test = 4;
          } else if (inRange(str_val, 14, 15)) {
              hit_mod = 0;
              dmg_mod = 0;
              encum_mod = 20;
              str_minor_test = 2;
              str_major_test = 7;
          } else if (str_val == 16) {
              hit_mod = 0;
              dmg_mod = 1;
              encum_mod = 35;
              str_minor_test = 3;
              str_major_test = 10;
          } else if (str_val == 17) {
              hit_mod = 1;
              dmg_mod = 1;
              encum_mod = 50;
              str_minor_test = 3;
              str_major_test = 13;
          } else if (str_val == 18 && str_percent == null) {
              hit_mod = 1;
              dmg_mod = 2;
              encum_mod = 75;
              str_minor_test = 3;
              str_major_test = 16;
          } else if (str_val == 18 && str_percent != null && inRange(str_percent, 1,50)) {
              hit_mod = 1;
              dmg_mod = 3;
              encum_mod = 100;
              str_minor_test = 3;
              str_major_test = 20;
          } else if (str_val == 18 && str_percent != null && inRange(str_percent, 51,75)) {
              hit_mod = 2;
              dmg_mod = 3;
              encum_mod = 125;
              str_minor_test = 4;
              str_major_test = 25;
          } else if (str_val == 18 && str_percent != null && inRange(str_percent, 76,90)) {
              hit_mod = 2;
              dmg_mod = 4;
              encum_mod = 150;
              str_minor_test = 4;
              str_major_test = 30;
          } else if (str_val == 18 && str_percent != null && inRange(str_percent, 91,99)) {
              hit_mod = 2;
              dmg_mod = 5;
              encum_mod = 200;
              str_minor_test = 4;
              str_major_test = 35;
          } else if ((str_val == 18 && str_percent != null && str_percent == 0) ||
                     str_val >= 19) {
              hit_mod = 3;
              dmg_mod = 6;
              encum_mod = 300;
              str_minor_test = 5;
              str_major_test = 40;
          }
          setAttrs({
              [`hit_mod`]: hit_mod,
              [`dmg_mod`]: dmg_mod,
              [`encum_mod`]: encum_mod,
              [`str_minor_test`]: str_minor_test,
              [`str_major_test`]: str_major_test
          });
      });
  });

  on(`change:dex change:dex_mod`, () => {
      getAttrs(["dex", "dex_mod"], values => {
          const dex_base = xparseInt(values["dex"]);
          const dex_mod = xparseInt(values["dex_mod"]);
          const dex_val = dex_base + dex_mod;

          surprise_mod = 0;
          missile_mod = 0;
          ac_mod = 0;
          if (dex_val <= -3) {
              surprise_mod = -3;
              missile_mod = -3;
              ac_mod = 4;
          } else if (dex_val == 4) {
              surprise_mod = -2;
              missile_mod = -2;
              ac_mod = 3;
          } else if (dex_val == 5) {
              surprise_mod = -1;
              missile_mod = -1;
              ac_mod = 2;
          } else if (dex_val == 16) {
              surprise_mod = 1;
              missile_mod = 1;
              ac_mod = -2;
          } else if (dex_val == 17) {
              surprise_mod = 2;
              missile_mod = 2;
              ac_mod = -3;
          } else if (dex_val >= 18) {
              surprise_mod = 3;
              missile_mod = 3;
              ac_mod = -4;
          }
          setAttrs({
              [`surprise_mod`]: surprise_mod,
              [`missile_mod`]: missile_mod,
              [`ac_mod`]: ac_mod
          });
      });
  });

  on(`change:con change:con_mod change:has_con_fighter_toggle`, () => {
      getAttrs(["con", "con_mod", "has_con_fighter_toggle"], values => {
          const con_base = xparseInt(values["con"]);
          const con_mod = xparseInt(values["con_mod"]);
          const con_val = con_base + con_mod;
          const is_fighter = (values["has_con_fighter_toggle"] == 'on' ? true : false);

          hp_mod = 0;
          if (con_val <= 3) {
              hp_mod = -2;
          } else if (inRange(con_val, 4, 6)) {
              hp_mod = -1;
          } else if (con_val == 15) {
              hp_mod = 1;
          } else if (con_val == 16) {
              hp_mod = 2;
          } else if (con_val > 16) {
              if (is_fighter && con_val == 17) {
                  hp_mod = 3;
              } else if (is_fighter && con_val == 18) {
                  hp_mod = 4;
              } else if (is_fighter && con_val >= 19) {
                  hp_mod = 5;
              } else {
                  hp_mod = 2;
              }
          }

          resurrect = 40;
          if (inRange(con_val, 3, 13)) {
              resurrect = 40 + ((con_val - 3) * 5);
          } else if (con_val >= 14 && con_val <= 18) {
              resurrect = 92 + ((con_val - 14) * 2);
          } else if (con_val >= 19) {
              resurrect = 100;
          }

          sys_shock = 35;
          if (inRange(con_val, 3, 13)) {
              sys_shock = 35 + ((con_val - 3) * 5);
          } else if (con_val == 14) {
              sys_shock = 88;
          } else if (con_val == 15) {
              sys_shock = 91;
          } else if (con_val == 16) {
              sys_shock = 95;
          } else if (con_val == 17) {
              sys_shock = 97;
          } else if (con_val >= 18) {
              sys_shock = 99;
          }

          setAttrs({
              [`hp_mod`]: hp_mod,
              [`resurrect`]: resurrect,
              [`sys_shock`]: sys_shock,
          });
      });
  });

  on(`change:int change:int_mod`, () => {
      getAttrs(["int", "int_mod"], values => {
          const int_base = xparseInt(values["int"]);
          const int_mod = xparseInt(values["int_mod"]);
          const int_val = int_base + int_mod;
          max_lang = 0;
          if (inRange(int_val, 8, 15)) {
              max_lang = 1 + Math.floor(((int_val - 8) / 2))
          } else if (inRange(int_val, 16, 19)) {
              max_lang = 5 + (int_val - 16);
          } else if (int_val > 19) {
              max_lang = 8;
          }

          max_spell = 0;
          min_spell = 0;
          learn_spell = 0;
          if (int_val == 9) {
              max_spell = 6;
              min_spell = 4;
              learn_spell = 35;
          } else if (inRange(int_val, 10, 12)) {
              max_spell = 7;
              min_spell = 5;
              learn_spell = 45;
          } else if (inRange(int_val, 13, 14)) {
              max_spell = 9;
              min_spell = 6;
              learn_spell = 55;
          } else if (inRange(int_val, 15, 16)) {
              max_spell = 11;
              min_spell = 7;
              learn_spell = 65;
          } else if (int_val == 17) {
              max_spell = 14;
              min_spell = 8;
              learn_spell = 75;
          } else if (int_val == 18) {
              max_spell = 18;
              min_spell = 9;
              learn_spell = 85;
          } else if (int_val >= 19) {
              max_spell = 22;
              min_spell = 10;
              learn_spell = 90;
          }

          setAttrs({
              [`max_lang`]: max_lang,
              [`min_spell`]: min_spell,
              [`max_spell`]: max_spell,
              [`learn_spell`]: learn_spell
          });
      });
  });
  on(`change:wis change:wis_mod`, () => {
      getAttrs(["wis", "wis_mod"], values => {
          const wis_base = xparseInt(values["wis"]);
          const wis_mod = xparseInt(values["wis_mod"]);
          const wis_val = wis_base + wis_mod;

          mental_mod = 0;
          bonus_spell = 0;
          spell_failure = 0;
          if (wis_val <= 3) {
              mental_mod = -3;
              bonus_spell = 0;
              spell_failure = 15;
          } else if (wis_val == 4) {
              mental_mod = -2;
              bonus_spell = 0;
              spell_failure = 15;
          } else if (inRange(wis_val, 5, 7)) {
              mental_mod = -1;
              bonus_spell = 0;
              spell_failure = 15;
          } else if (inRange(wis_val, 8, 9)) {
              mental_mod = 0;
              bonus_spell = 0;
              spell_failure = 15;
          } else if (wis_val == 10) {
              mental_mod = 0;
              bonus_spell = 0;
              spell_failure = 10;
          } else if (wis_val == 11) {
              mental_mod = 0;
              bonus_spell = 0;
              spell_failure = 5;
          } else if (wis_val == 12) {
              mental_mod = 0;
              bonus_spell = 0;
              spell_failure = 1;
          } else if (wis_val == 13) {
              mental_mod = 0;
              bonus_spell = 1;
              spell_failure = 0;
          } else if (wis_val == 14) {
              mental_mod = 0;
              bonus_spell = 2;
              spell_failure = 0;
          } else if (wis_val == 15) {
              mental_mod = 1;
              bonus_spell = '2/1';
              spell_failure = 0;
          } else if (wis_val == 16) {
              mental_mod = 2;
              bonus_spell = '2/2';
              spell_failure = 0;
          } else if (wis_val == 17) {
              mental_mod = 3;
              bonus_spell = '2/2/1';
              spell_failure = 0;
          } else if (wis_val == 18) {
              mental_mod = 4;
              bonus_spell = '2/2/1/1';
              spell_failure = 0;
          } else if (wis_val >= 19) {
              mental_mod = 5;
              bonus_spell = '3/2/1/1';
              spell_failure = 0;
          }

          setAttrs({
              [`mental_mod`]: mental_mod,
              [`bonus_spell`]: bonus_spell,
              [`spell_failure`]: spell_failure

          });
      });
  });
  on(`change:cha change:cha_mod`, () => {
      getAttrs(["cha", "cha_mod"], values => {
          const cha_base = xparseInt(values["cha"]);
          const cha_mod = xparseInt(values["cha_mod"]);
          const cha_val = cha_base + cha_mod;

          max_hench = 0;
          loyalty_mod = 0;
          react_mod = 0;
          if (cha_val <= 3) {
              max_hench = 1;
              loyalty_mod = -30;
              react_mod = -25;
          } else if (cha_val == 4) {
              max_hench = 1;
              loyalty_mod = -25;
              react_mod = -20;
          } else if (cha_val == 5) {
              max_hench = 2;
              loyalty_mod = -20;
              react_mod = -15;
          } else if (cha_val == 6) {
              max_hench = 2;
              loyalty_mod = -15;
              react_mod = -10;
          } else if (cha_val == 7) {
              max_hench = 3;
              loyalty_mod = -10;
              react_mod = -5;
          } else if (cha_val == 8) {
              max_hench = 3;
              loyalty_mod = -5;
              react_mod = 0;
          } else if (cha_val == 9) {
              max_hench = 4;
              loyalty_mod = 0;
              react_mod = 0;
          } else if (inRange(cha_val, 9, 11)) {
              max_hench = 4;
              loyalty_mod = 0;
              react_mod = 0;
          } else if (cha_val == 12) {
              max_hench = 5;
              loyalty_mod = 0;
              react_mod = 0;
          } else if (cha_val == 13) {
              max_hench = 5;
              loyalty_mod = 0;
              react_mod = 5;
          } else if (cha_val == 14) {
              max_hench = 6;
              loyalty_mod = 5;
              react_mod = 10;
          } else if (cha_val == 15) {
              max_hench = 7;
              loyalty_mod = 15;
              react_mod = 15;
          } else if (cha_val == 16) {
              max_hench = 8;
              loyalty_mod = 20;
              react_mod = 25;
          } else if (cha_val == 17) {
              max_hench = 10;
              loyalty_mod = 30;
              react_mod = 30;
          } else if (cha_val == 18) {
              max_hench = 15;
              loyalty_mod = 40;
              react_mod = 35;
          } else if (cha_val >= 19) {
              max_hench = 20;
              loyalty_mod = 50;
              react_mod = 40;
          }

          setAttrs({
              [`max_hench`]: max_hench,
              [`loyalty_mod`]: loyalty_mod,
              [`react_mod`]: react_mod,
          });

      });
  });

  on('change:repeating_equipment:equip_weight change:repeating_equipment:equip_count change:repeating_equipment:equip_is remove:repeating_equipment', function () {
      repeatingSum('equip_encumbrance', 'equipment', ['equip_weight', 'equip_count', 'equip_is']);
  });

  on('change:pp_equip change:gp_equip change:ep_equip change:sp_equip change:cp_equip', function () {
      getAttrs(['pp_equip', 'gp_equip', 'ep_equip', 'sp_equip', 'cp_equip', 'encumbrance'], function (values) {
          const encumbrance = Math.floor((xparseFloat(values.pp_equip) +
                                          xparseFloat(values.gp_equip) +
                                          xparseFloat(values.ep_equip) +
                                          xparseFloat(values.sp_equip) +
                                          xparseFloat(values.cp_equip)) / 10);
          setAttrs({
              [`coin_encumbrance`]: encumbrance
          });
      });
  });

  on('change:equip_encumbrance change:coin_encumbrance change:base_mv change:encum_mod change:mv_limit', function () {
      getAttrs(['equip_encumbrance', 'coin_encumbrance', 'base_mv', 'encum_mod', 'mv_limit'], function (values) {
          const encumbrance = xparseFloat(values.equip_encumbrance) + xparseFloat(values.coin_encumbrance);
          const mv_encum = encumbrance - values.encum_mod;
          const mv_limit = values.mv_limit
          max_mv = values.base_mv;
          encum_surprise = '+1';
          if (inRange(mv_encum, 36, 70)) {
              max_mv -= 30;
              encum_surprise = ' ';
          } else if (inRange(mv_encum, 71, 105)) {
              max_mv -= 60;
              encum_surprise = 'NB';
          } else if (inRange(mv_encum, 106, 150)) {
              max_mv -= 90;
              encum_surprise = '-1';
          } else if (mv_encum > 150) {
              max_mv = 0;
              encum_surprise = '-1';
          }
          max_mv = Math.max(Math.min(max_mv, mv_limit),0);

          setAttrs({
              [`encumbrance`]: encumbrance,
              [`max_mv`]: max_mv,
              [`encum_surprise`]: encum_surprise
          });
      });
  });

  on('change:weapon_toggle', function () {
      getAttrs(['weapon_toggle'], function (value) {
          setAttrs({
              [`weapon_tab`]: value.weapon_toggle
          });
      });
  });

  on('change:ability_toggle', function () {
      getAttrs(['ability_toggle'], function (value) {
          setAttrs({
              [`ability_tab`]: value.ability_toggle
          });
      });
  });

  on('change:items_toggle', function () {
      getAttrs(['items_toggle'], function (value) {
          setAttrs({
              [`items_tab`]: value.items_toggle
          });
      });
  });

  on('change:sheet_toggle', function () {
      getAttrs(['sheet_toggle'], function (value) {
          setAttrs({
              [`sheet_tab`]: value.sheet_toggle
          });
      });
  });
</script>
